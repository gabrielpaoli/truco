<!doctype html>
<html>
  <head>
    <title>Truco</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  </head>


  <body>
    <div class="container container-general-game">
      <div class="row">
        <div class="container-game col-md-8">
          <div class="row">
            <div id="player1">Player 1</div>
            <div class="container-player1-cards col-md-12">
              <div class="card" data-player="player-1" id="card1"></div>
              <div class="card" data-player="player-1" id="card2"></div>
              <div class="card" data-player="player-1" id="card3"></div>
            </div>
          </div>

          <div class="row">
            <div class="board col-md-12">
              <div class="container-board-cards container-board-cards-1">
                <div class="cardBoard" data-player="player-1" id="playedCard1"></div>
                <div class="cardBoard" data-player="player-1" id="playedCard2"></div>
                <div class="cardBoard" data-player="player-1" id="playedCard3"></div>
              </div>

              <div class="container-board-cards container-board-cards-2">
                <div class="cardBoard" data-player="player-2" id="playedCard4"></div>
                <div class="cardBoard" data-player="player-2" id="playedCard5"></div>
                <div class="cardBoard" data-player="player-2" id="playedCard6"></div>
              </div>
            </div>
          </div>

          <div class="row">
            <div id="player2">Player 2</div>
            <div class="container-player2-cards col-md-12">
              <div class="card" data-player="player-2" id="card4"></div>
              <div class="card" data-player="player-2" id="card5"></div>
              <div class="card" data-player="player-2" id="card6"></div>
            </div>
          </div>
        </div>

        <div class="container-general col-md-4">
          <div class="col-md-12">
            <div class="btn btn-primary" id="init">Repartir</div>
            <div id="envido">Envido</div>
            <div id="truco">Truco</div>
            <div id="flor">Flor</div>
            <div id="envido2">Envido</div>
            <div id="real-envido">Real envido</div>
            <div id="real-envido2">Real envido</div>
            <div id="falta-envido">Falta envido</div>
          </div>
         </div>
      </div>
    </div>
  </body>


  <script>
    $(function () {
      var socket = io();
      var counter = 0;

      //On click repartir
      $('#init').click(function(){
        socket.emit('init');
      });
      socket.on('init', function(handCards){
        console.log(handCards);
        setHandCards(handCards);
      });

      //On click card
      $('.card').click(function(){
        var selectedCard = $(this);
        var id = selectedCard.context.id;
        var player = getPlayer(selectedCard);
        getEmptyCardBoardAndSetCardPlayer(selectedCard, player);
        socket.emit('card', $(this));
      });
      socket.on('card', function(handCards){


        
      });

      function getPlayer(selectedCard){
        if(selectedCard.context.dataset.player === 'player-1'){
          player = 1;
        }else{
          player = 2;
        }
        return player;
      }

      //Get empty spaces in boards and set card player
      function getEmptyCardBoardAndSetCardPlayer(selectedCard, player){
        $( ".container-board-cards-" + player + " .cardBoard" ).each(function( index, value ) {
          if ($(this).find(".card").length > 0){ 
          }else{
            var boardCard = $(this);
            $(selectedCard).appendTo("#" + boardCard.context.id);
            return false;
          }
        });
      }

      //Set Hand Cards
      function setHandCards(handCards){
        $(".card").empty();
        
        $( ".container-player1-cards .card" ).each(function( index, value ) {
          $(this).append( handCards[0].cards[index].cardText);
          $(this).attr('data-number', handCards[0].cards[index].number);
          $(this).attr('data-suit', handCards[0].cards[index].suit);
        });

        $( ".container-player2-cards .card" ).each(function( index, value ) {
          $(this).append( handCards[1].cards[index].cardText);
          $(this).attr('data-number', handCards[1].cards[index].number);
          $(this).attr('data-suit', handCards[1].cards[index].suit);
        });
      }

      function setHandHandIcon(handCards){
        $(".handIcon").empty();
      }

    });
  </script>
    

</html>